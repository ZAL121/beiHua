<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>呗花-登录</title>
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/login.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!--导入angularJS文件-->
    <!--<script src="js/angular.min.js"></script>-->
    <!--导入jquery-->
    <script src="js/jquery-3.3.1.js"></script>

</head>
<script>
    window.onload = function () {
        $("#checkCodeChooseID").attr("src", "/makeCC/makeCheckCode?" + new Date().getTime());
    };


</script>
<script>

    $(function () {
        //登录时，每次点击登录后，应该首先判断验证码是否正确，然后再判断用户和密码
        // (这个功能目前先不写，直接判断用户名和密码)

        var usernameFlag = false;
        var checkCodeFiag = false;
        //用户名校验
        $("#username").blur(function () {
            if ($(this).val() == null || $(this).val().trim() == "") {
                //用户名为空
                $("#usernameinfo").html("用户名不能为空!")
                usernameFlag = false;
            } else {
                usernameFlag = true;
            }
        })
        //验证码校验
        $("#check").blur(function () {
            if ($(this).val() != null && $(this).val().trim() != "") {
                $("#verifyCodeInfo").html("");
                var intputCheckCode = $(this).val();
                //验证码不为空时，使用异步校验
                $.get("/UserController/checkCode?inputCheckCode=" + intputCheckCode + "", function (data) {
                    if ("yes" == data) {
                        //成功
                        $("#verifyCodeInfo").html("");
                        checkCodeFiag = true;
                    } else if ("no" == data) {
                        //错误
                        $("#verifyCodeInfo").html("验证码错误!");
                        alert("验证码错误");
                        checkCodeFiag = false;
                    }
                }, "text");
            } else {
                //验证码为空
                $("#verifyCodeInfo").html("验证码不能为空!");
                checkCodeFiag = false;
            }
        })

        $("#loginButton").click(function () {
            if (!(usernameFlag && checkCodeFiag)) {
                alert("输入有非法项，请核实");
                return;
            }
            var inputUsername = $("#loginForm input[name='username']").val();

            var inputPassword = $("#loginForm input[name='password']").val();

            $.get("/UserController/login", {
                "username": inputUsername,
                "password": inputPassword
            }, function (resultInfo) {

                if (resultInfo.flag) {
                    //登录成功，跳转页面
                    $("#errorMsg").hide();
                    location.href = "/index.html";
                } else {
                    //登录失败，显示错误信息
                    $("#errorMsg").html(resultInfo.errorMsg).show();
                }

            }, "json")

        })

    })
</script>
<body>
<!--引入头部-->
<div id="header"></div>
<!-- 头部 end -->
<section id="login_wrap">
    <div class="fullscreen-bg" style="background: url(images/login_bg.png);height: 532px;">

    </div>
    <div class="login-box">
        <div class="title">
            <img src="images/login_logo.png" alt="">
            <span>欢迎登录呗花账户</span>
        </div>
        <div class="login_inner">

            <!--登录错误提示消息-->
            <div id="errorMsg" class="alert alert-danger" style="display: none"></div>
            <form id="loginForm" action="" method="post" accept-charset="utf-8">
                <input name="username" id="username" type="text" placeholder="请输入账号" autocomplete="off">
                <input name="password" type="password" placeholder="请输入密码" autocomplete="off">
                <div class="verify">
                    <input name="check" id="check" type="text" placeholder="请输入验证码" autocomplete="off">
                    <img id="checkCodeChooseID" src="checkCode" height="32px" alt=""
                         onclick="changeCheckCode(this)">
                    <span id="verifyCodeInfo"
                          style="position: relative;left: 250px;top: -25px;color: red"><&nbsp;></span>
                    <script type="text/javascript">
                        //图片点击事件
                        function changeCheckCode(img) {
                            img.src = "/makeCC/makeCheckCode?" + new Date().getTime();
                        }
                    </script>
                </div>
                <!--为了美观，换行处理-->
                <br/>
                <br/>
                <div class="submit_btn" style="text-align: center">
                    <button type="button" id="loginButton" >登录</button>
                    <!--    <div class="auto_login">
                           <input type="checkbox" name="" class="checkbox">
                           <span>自动登录</span>
                       </div>-->
                </div>
            </form>
            <div class="reg">没有账户？<a href="http://localhost:8080/register.html">立即注册</a></div>
        </div>
    </div>
</section>
<!--引入尾部-->
<div id="footer"></div>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery-1.11.0.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>
<!--导入布局js，共享header和footer-->
<script type="text/javascript" src="js/include.js"></script>
</body>

</html>